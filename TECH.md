# 技术文档

## 1. 设计目标

- 断网后自动触发校园网认证
- 自动填写账号密码并点击登录
- 连通性恢复后继续监控

## 2. 核心流程

1. 通过 `ping` 检测外网连通性（`CHECK_HOST`）
2. 若断网，启动 Playwright + Edge
3. 打开认证页面 `LOGIN_URL`
4. 自动填充账号/密码
5. 点击登录按钮（`#loginLink`）
6. 反复检测连通性，成功则关闭浏览器
7. 继续监控

## 3. 模块说明

- `is_network_up()`
  - 用 `ping` 判断外网是否可达

- `get_user_credentials()`
  - 优先读取 `login_credentials.json`
  - 若不存在则弹窗输入，失败再回退到控制台输入

- `auto_login()`
  - 使用 Playwright 自动打开网页、填写、点击、验证
  - 失败会重试（固定次数）

## 4. 自动填充策略

- 用户名输入框：`#username`
- 密码输入框：`#pwd`
- 使用 `page.evaluate()` 直接写入 DOM 并触发 `input/change` 事件

## 5. 异常与兜底

- Playwright 未安装：启动即报错，需安装依赖
- Edge 启动失败：自动回退使用 Chromium
- 登录失败：重试 3 次
- 凭据缺失：弹窗提示输入
- 连通性检测失败：继续监控，下次重试

## 6. 可扩展点

- 多 Host 检测：提高网络判断准确性
- 失败指数退避：避免频繁拉起浏览器
- 凭据失效自动清除：登录失败多次后删除凭据文件
- 增加日志文件：便于长期追踪

## 7. 注意事项

- 认证页面 DOM 可能变化，若选择器失效需更新
- 网络抖动会触发多次登录尝试
- 凭据存储为明文，请自行保护文件
